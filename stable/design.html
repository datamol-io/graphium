
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Graphium: Scaling molecular GNNs to infinity.">
      
      
      
        <link rel="canonical" href="https://github.com/datamol-io/graphium/stable/design.html">
      
      
        <link rel="prev" href="tutorials/model_training/simple-molecular-model.html">
      
      
        <link rel="next" href="datasets.html">
      
      <link rel="icon" href="images/logo.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Design - graphium</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="_assets/css/custom.css">
    
      <link rel="stylesheet" href="_assets/css/custom-graphium.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#graphium-library-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="graphium" class="md-header__button md-logo" aria-label="graphium" data-md-component="logo">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            graphium
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Design
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/datamol-io/graphium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    valence-discovery/graphium
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="baseline.html" class="md-tabs__link">
      Baseline
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="api/graphium.nn/graphium.nn.html" class="md-tabs__link">
        API
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="tutorials/feature_processing/add_new_positional_encoding.html" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

  

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="design.html" class="md-tabs__link md-tabs__link--active">
      Design
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="datasets.html" class="md-tabs__link">
      Datasets
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="pretrained_models.html" class="md-tabs__link">
      Pretrained Models
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="contribute.html" class="md-tabs__link">
      Contribute
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="license.html" class="md-tabs__link">
      License
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="cli_references.html" class="md-tabs__link">
      CLI
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="graphium" class="md-nav__button md-logo" aria-label="graphium" data-md-component="logo">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    graphium
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/datamol-io/graphium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    valence-discovery/graphium
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="baseline.html" class="md-nav__link">
        Baseline
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          graphium.nn
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          graphium.nn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.nn/graphium.nn.html" class="md-nav__link">
        graphium.nn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.nn/architectures.html" class="md-nav__link">
        graphium.nn.architectures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.nn/encoders.html" class="md-nav__link">
        graphium.nn.encoders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.nn/pyg_layers.html" class="md-nav__link">
        graphium.nn.pyg_layers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.features.html" class="md-nav__link">
        graphium.features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.trainer.html" class="md-nav__link">
        graphium.trainer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.data.html" class="md-nav__link">
        graphium.data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.utils.html" class="md-nav__link">
        graphium.utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.config.html" class="md-nav__link">
        graphium.config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.ipu.html" class="md-nav__link">
        graphium.ipu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/graphium.visualization.html" class="md-nav__link">
        graphium.visualization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          feature_processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          feature_processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/feature_processing/add_new_positional_encoding.html" class="md-nav__link">
        Add new positional encoding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/feature_processing/csv_to_parquet.html" class="md-nav__link">
        Convert CSV to Parquet files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/feature_processing/timing_parallel.html" class="md-nav__link">
        Timing parallel processing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          gnn_layers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          gnn_layers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/gnn/add_new_gnn_layers.html" class="md-nav__link">
        Creating GNN layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/gnn/making_gnn_networks.html" class="md-nav__link">
        Making GNN Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/gnn/using_gnn_layers.html" class="md-nav__link">
        Using GNN layers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          model_training
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          model_training
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/model_training/simple-molecular-model.html" class="md-nav__link">
        Building and training a simple model from configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/model_training/ipu_training.ipynb" class="md-nav__link">
        Training on IPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/basics/choosing_parallelization.ipynb" class="md-nav__link">
        Chosing the right parallelization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="design.html" class="md-nav__link md-nav__link--active">
        Design
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diagram-for-data-processing-in-molgps" class="md-nav__link">
    Diagram for data processing in molGPS.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagram-for-muti-task-network-in-molgps" class="md-nav__link">
    Diagram for Muti-task network in molGPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-setup" class="md-nav__link">
    Data setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-the-code" class="md-nav__link">
    Structure of the code
  </a>
  
    <nav class="md-nav" aria-label="Structure of the code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data_parser" class="md-nav__link">
    data_parser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trainer" class="md-nav__link">
    trainer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    utils
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    visualization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-the-code" class="md-nav__link">
    Modifying the code
  </a>
  
    <nav class="md-nav" aria-label="Modifying the code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-new-gnn-layer" class="md-nav__link">
    Adding a new GNN layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-new-nn-architecture" class="md-nav__link">
    Adding a new NN architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-predictormodule-and-loss-function" class="md-nav__link">
    Changing the PredictorModule and loss function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-metrics-used" class="md-nav__link">
    Changing the metrics used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="datasets.html" class="md-nav__link">
        Datasets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="pretrained_models.html" class="md-nav__link">
        Pretrained Models
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="contribute.html" class="md-nav__link">
        Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="license.html" class="md-nav__link">
        License
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="cli_references.html" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#diagram-for-data-processing-in-molgps" class="md-nav__link">
    Diagram for data processing in molGPS.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagram-for-muti-task-network-in-molgps" class="md-nav__link">
    Diagram for Muti-task network in molGPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-setup" class="md-nav__link">
    Data setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-the-code" class="md-nav__link">
    Structure of the code
  </a>
  
    <nav class="md-nav" aria-label="Structure of the code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data_parser" class="md-nav__link">
    data_parser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trainer" class="md-nav__link">
    trainer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    utils
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    visualization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-the-code" class="md-nav__link">
    Modifying the code
  </a>
  
    <nav class="md-nav" aria-label="Modifying the code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-new-gnn-layer" class="md-nav__link">
    Adding a new GNN layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-new-nn-architecture" class="md-nav__link">
    Adding a new NN architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-predictormodule-and-loss-function" class="md-nav__link">
    Changing the PredictorModule and loss function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-metrics-used" class="md-nav__link">
    Changing the metrics used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="graphium-library-design">Graphium Library Design<a class="headerlink" href="#graphium-library-design" title="Permanent link">&para;</a></h1>
<hr />
<h3 id="diagram-for-data-processing-in-molgps">Diagram for data processing in molGPS.<a class="headerlink" href="#diagram-for-data-processing-in-molgps" title="Permanent link">&para;</a></h3>
<p><img src="images/datamodule.png" alt= "Data Processing Chart" width="100%" height="100%"></p>
<h3 id="diagram-for-muti-task-network-in-molgps">Diagram for Muti-task network in molGPS<a class="headerlink" href="#diagram-for-muti-task-network-in-molgps" title="Permanent link">&para;</a></h3>
<p><img src="images/full_graph_network.png" alt= "Full Graph Multi-task Network" width="100%" height="100%"></p>
<p><strong>Section from the previous README:</strong></p>
<h3 id="data-setup">Data setup<a class="headerlink" href="#data-setup" title="Permanent link">&para;</a></h3>
<p>Then, you need to download the data needed to run the code. Right now, we have 2 sets of data folders, present in the link <a href="https://drive.google.com/drive/folders/1RrbNZkEE2rf41_iroa1LbIyegW00h3Ql?usp=sharing">here</a>.</p>
<ul>
<li><strong>micro_ZINC</strong> (Synthetic dataset)</li>
<li>A small subset (1000 mols) of the ZINC dataset</li>
<li>The score is the subtraction of the computed LogP and the synthetic accessibility score SA</li>
<li>
<p>The data must be downloaded to the folder <code>./graphium/data/micro_ZINC/</code></p>
</li>
<li>
<p><strong>ZINC_bench_gnn</strong> (Synthetic dataset)</p>
</li>
<li>A subset (12000 mols) of the ZINC dataset</li>
<li>The score is the subtraction of the computed LogP and the synthetic accessibility score SA</li>
<li>These are the same 12k molecules provided by the <a href="https://github.com/graphdeeplearning/benchmarking-gnns">Benchmarking-gnn</a> repository.<ul>
<li>We provide the pre-processed graphs in <code>ZINC_bench_gnn/data_from_benchmark</code></li>
<li>We provide the SMILES in <code>ZINC_bench_gnn/smiles_score.csv</code>, with the train-val-test indexes in the file <code>indexes_train_val_test.csv</code>.</li>
<li>The first 10k elements are the training set</li>
<li>The next 1k the valid set</li>
<li>The last 1k the test set.</li>
</ul>
</li>
<li>The data must be downloaded to the folder <code>./graphium/data/ZINC_bench_gnn/</code></li>
</ul>
<p>Then, you can run the main file to make sure that all the dependancies are correctly installed and that the code works as expected.</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>expts/main_micro_zinc.py
</code></pre></div>
<hr />
<p><strong>TODO: explain the internal design of Graphium so people can contribute to it more easily.</strong></p>
<h2 id="structure-of-the-code">Structure of the code<a class="headerlink" href="#structure-of-the-code" title="Permanent link">&para;</a></h2>
<p>The code is built to rapidly iterate on different architectures of neural networks (NN) and graph neural networks (GNN) with Pytorch. The main focus of this work is molecular tasks, and we use the package <code>rdkit</code> to transform molecular SMILES into graphs.</p>
<h3 id="data_parser">data_parser<a class="headerlink" href="#data_parser" title="Permanent link">&para;</a></h3>
<p>This folder contains tools that allow tdependenciesrent kind of molecular data files, such as <code>.csv</code> or <code>.xlsx</code> with SMILES data, or <code>.sdf</code> files with 3D data.</p>
<h3 id="features">features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h3>
<p>Different utilities for molecules, such as Smiles to adjacency graph transformer, molecular property extraction, atomic properties, bond properties, ...</p>
<p><strong><em>The MolecularTransformer and AdjGraphTransformer come from ivbase, but I don't like them. I think we should replace them with something simpler and give more flexibility for combining one-hot embedding with physical properties embedding.</em></strong>.</p>
<h3 id="trainer">trainer<a class="headerlink" href="#trainer" title="Permanent link">&para;</a></h3>
<p>The trainer contains the interface to the <code>pytorch-lightning</code> library, with <code>PredictorModule</code> being the main class used for any NN model, either for regression or classification. It also contains some modifications to the logger from <code>pytorch-lightning</code> to enable more flexibility.</p>
<h3 id="utils">utils<a class="headerlink" href="#utils" title="Permanent link">&para;</a></h3>
<p>Any kind of utilities that can be used anywhere, including argument checkers and configuration loader</p>
<h3 id="visualization">visualization<a class="headerlink" href="#visualization" title="Permanent link">&para;</a></h3>
<p>Plot visualization tools</p>
<h2 id="modifying-the-code">Modifying the code<a class="headerlink" href="#modifying-the-code" title="Permanent link">&para;</a></h2>
<h3 id="adding-a-new-gnn-layer">Adding a new GNN layer<a class="headerlink" href="#adding-a-new-gnn-layer" title="Permanent link">&para;</a></h3>
<p>Any new GNN layer must inherit from the class <code>graphium.nn.base_graph_layer.BaseGraphLayer</code> and be implemented in the folder <code>graphium/nn/pyg_layers</code>, imported in the file <code>graphium/nn/architectures.py</code>, and in the same file, added to the function <code>FeedForwardGraph._parse_gnn_layer</code>.</p>
<p>To be used in the configuration file as a <code>graphium.model.layer_name</code>, it must also be implemented with some variable parameters in the file <code>expts/config_gnns.yaml</code>.</p>
<h3 id="adding-a-new-nn-architecture">Adding a new NN architecture<a class="headerlink" href="#adding-a-new-nn-architecture" title="Permanent link">&para;</a></h3>
<p>All NN and GNN architectures compatible with the <code>pyg</code> library are provided in the file <code>graphium/nn/global_architectures.py</code>. When implementing a new architecture, it is highly recommended to inherit from <code>graphium.nn.architectures.FeedForwardNN</code> for regular neural networks, from <code>graphium.nn.global_architectures.FeedForwardGraph</code> for pyg neural network, or from any of their sub-classes.</p>
<h3 id="changing-the-predictormodule-and-loss-function">Changing the PredictorModule and loss function<a class="headerlink" href="#changing-the-predictormodule-and-loss-function" title="Permanent link">&para;</a></h3>
<p>The <code>PredictorModule</code> is a general pytorch-lightning module that should work with any kind of <code>pytorch.nn.Module</code> or <code>pl.LightningModule</code>. The class defines a structure of including models, loss functions, batch sizes, collate functions, metrics...</p>
<p>Some loss functions are already implemented in the PredictorModule, including <code>mse, bce, mae, cosine</code>, but some tasks will require more complex loss functions. One can add any new function in <code>graphium.trainer.predictor.PredictorModule._parse_loss_fun</code>.</p>
<h3 id="changing-the-metrics-used">Changing the metrics used<a class="headerlink" href="#changing-the-metrics-used" title="Permanent link">&para;</a></h3>
<p><strong><em>!WARNING! The metrics implementation was done for pytorch-lightning v0.8. There has been major changes to how the metrics are used and defined, so the whole implementation must change.</em></strong></p>
<p>Our current code is compatible with the metrics defined by <em>pytorch-lightning</em>, which include a great set of metrics. We also added the PearsonR and SpearmanR as they are important correlation metrics. You can define any new metric in the file <code>graphium/trainer/metrics.py</code>. The metric must inherit from <code>TensorMetric</code> and must be added to the dictionary <code>graphium.trainer.metrics.METRICS_DICT</code>.</p>
<p>To use the metric, you can easily add it's name from <code>METRICS_DICT</code> in the yaml configuration file, at the address <code>metrics.metrics_dict</code>. Each metric has an underlying dictionnary with a mandatory <code>threshold</code> key containing information on how to threshold the prediction/target before computing the metric. Any <code>kwargs</code> arguments of the metric must also be added.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2020 - 2023 datamol.io
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.expand"], "search": "assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="javascripts/config.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>